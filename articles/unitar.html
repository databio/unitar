<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting started with unitar • unitar</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting started with unitar">
<meta property="og:description" content="unitar">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">unitar</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/unitar.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/databio/unitar/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="unitar_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting started with unitar</h1>
                        <h4 class="author">Nathan Sheffield</h4>
            
            <h4 class="date">2021-05-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/databio/unitar/blob/master/vignettes/unitar.Rmd"><code>vignettes/unitar.Rmd</code></a></small>
      <div class="hidden name"><code>unitar.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>Unitar is a simple R package that wraps the <a href="https://github.com/ropensci/targets">targets</a> package. To use unitar, you will need to already be familiar with <code>targets</code>, because the functionality is just an extension of targets and the naming conventions all follow the targets package approach. Unitar adds new functionality to use targets that span projects, which is outside the scope of the base targets package. With unitar, you can very easily link two targets projects, loading in built targets from other projects so that you can share caches and computing across users and projects.</p>
<div id="installing-unitar" class="section level2">
<h2 class="hasAnchor">
<a href="#installing-unitar" class="anchor"></a>Installing unitar</h2>
<p>Install <code>unitar</code> like this:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"databio/unitar"</span><span class="op">)</span></code></pre></div>
</div>
<div id="three-modes-of-use" class="section level2">
<h2 class="hasAnchor">
<a href="#three-modes-of-use" class="anchor"></a>Three modes of use</h2>
<p>There are three primary ways to use <code>unitar</code>, which differ in the way they treat external targets. External targets are targets that are not part of the current project, but belong to a different targets project. The 3 modes are:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Basic loading of external targets</strong>: Load targets computed in other projects. Don’t track these in the current targets project, just re-use them, and let all tracking happen in the external project. This is the basic case.</p></li>
<li><p><strong>Load and track external targets locally</strong>: Load external targets and also track them here. Duplicate external caches into local caches. If the external data changes, it will update the local caches, and all local files for the current project.</p></li>
<li><p><strong>Load and track external targets, but don’t duplicate caches</strong>: Load external targets and track the original files here, but don’t duplicate them into here. This can you do by just adding a “file” target with the external target file, and then writing functions that use this to produce whatever derived targets you need. This way, your targets will update if the external target changes, but you don’t have to pay the cost of storing the cache twice.</p></li>
</ol>
<p>For my use case, #3 is the most useful, but the others may also be useful depending on what you want.</p>
<div id="use-case-1-basic-loading-of-external-targets" class="section level3">
<h3 class="hasAnchor">
<a href="#use-case-1-basic-loading-of-external-targets" class="anchor"></a>Use case #1: Basic loading of external targets</h3>
<p>In the <a href="/target_projects">target_projects</a>, we have 2 subfolders. Each of these represents a separate project that uses targets; you can find a <code>_targets.R</code> file in each subfolder. These represent your typical, independent targets project folders.</p>
<p>Here’s how you’d load these targets in using <code>unitar_read</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/databio/unitar">"unitar"</a></span><span class="op">)</span></code></pre></div>
<pre><code>## Loading required package: targets</code></pre>
<pre><code>## Loading required package: fs</code></pre>
<pre><code>## Loading required package: withr</code></pre>
<pre><code>## Registered S3 method overwritten by 'pryr':
##   method      from
##   print.bytes Rcpp</code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">project_root</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"target_projects"</span>, package<span class="op">=</span><span class="st">"unitar"</span><span class="op">)</span>

<span class="va">project_subfolders</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="va">project_root</span><span class="op">)</span>
<span class="va">project_folders</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">project_root</span>, <span class="va">project_subfolders</span>, sep<span class="op">=</span><span class="st">"/"</span><span class="op">)</span>

<span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/unitar_make.html">unitar_make</a></span><span class="op">(</span><span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## Loading required package: fs
## Loading required package: withr
## Registered S3 method overwritten by 'pryr':
##   method      from
##   print.bytes Rcpp
## ../refdata1
## ✔ skip target file
## ✔ skip target big_data_set
## ✔ skip pipeline
## Warning message:
## In file_diff_dbl(chr) : NAs introduced by coercion</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## Loading required package: fs
## Loading required package: withr
## Registered S3 method overwritten by 'pryr':
##   method      from
##   print.bytes Rcpp
## • start target big_data_set_path
## big_data_set
## • end pipeline
## Error : target big_data_set_path did not return a character. dynamic files (targets with format = "file") must return character vectors of file or directory paths.</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## ✔ skip target big_data_set
## ✔ skip target filtered_data
## ✔ skip pipeline</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<pre><code>## ✔ skip target ref2
## ✔ skip target filt_ref2
## ✔ skip pipeline</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## [1] NA
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL</code></pre>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">big_data_set</span> <span class="op">=</span> <span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/unitar_read.html">unitar_read</a></span><span class="op">(</span><span class="st">"big_data_set"</span>, <span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">big_data_set</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.39609368 -0.04912618 -1.39020596 -0.74866919  0.93453822  0.97008189</code></pre>
<p><code>unitar_read</code> works like <code>tar_read</code>, but you give it a priority list of targets folders to search, and so it can search outside your current targets environment. This way you can share built targets across projects.</p>
<p><code>unitar_meta</code> works like <code>tar_meta</code>, but runs across all the given project folders:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/unitar_meta.html">unitar_meta</a></span><span class="op">(</span><span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<pre><code>## [[1]]
## # A tibble: 3 x 17
##   name   type   data    command depend     seed path  time                size  
##   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt; &lt;lis&gt; &lt;dttm&gt;              &lt;chr&gt; 
## 1 targe… object 5b00c8… &lt;NA&gt;    &lt;NA&gt;    NA      &lt;chr… NA                  &lt;NA&gt;  
## 2 file   stem   d73876… af9359… ef46db… -1.30e9 &lt;chr… 2021-05-13 16:17:08 c04bb…
## 3 big_d… stem   d73876… a4ce67… 80369c… -7.77e8 &lt;chr… 2021-05-13 16:17:08 c04bb…
## # … with 8 more variables: bytes &lt;int&gt;, format &lt;chr&gt;, iteration &lt;chr&gt;,
## #   parent &lt;lgl&gt;, children &lt;list&gt;, seconds &lt;dbl&gt;, warnings &lt;lgl&gt;, error &lt;lgl&gt;
## 
## [[2]]
## # A tibble: 2 x 17
##   name  type  data  command depend    seed path  time                size  bytes
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;lis&gt; &lt;dttm&gt;              &lt;lgl&gt; &lt;int&gt;
## 1 big_… stem  &lt;NA&gt;  ad0848… 77bd0… -3.10e8 &lt;chr… NA                  NA        0
## 2 loca… func… a1c5… &lt;NA&gt;    &lt;NA&gt;   NA      &lt;chr… NA                  NA       NA
## # … with 7 more variables: format &lt;chr&gt;, iteration &lt;chr&gt;, parent &lt;lgl&gt;,
## #   children &lt;list&gt;, seconds &lt;dbl&gt;, warnings &lt;lgl&gt;, error &lt;chr&gt;
## 
## [[3]]
## # A tibble: 4 x 17
##   name    type   data   command  depend     seed path  time                size 
##   &lt;chr&gt;   &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;     &lt;int&gt; &lt;lis&gt; &lt;dttm&gt;              &lt;chr&gt;
## 1 build_… funct… 222a0… &lt;NA&gt;     &lt;NA&gt;    NA      &lt;chr… NA                  &lt;NA&gt; 
## 2 filter… funct… 64192… &lt;NA&gt;     &lt;NA&gt;    NA      &lt;chr… NA                  &lt;NA&gt; 
## 3 big_da… stem   d7387… b17c53f… 3119dd… -7.77e8 &lt;chr… 2021-05-13 16:17:08 c04b…
## 4 filter… stem   f550c… 0eb59b1… 15faf7… -1.06e9 &lt;chr… 2021-05-13 16:17:08 0992…
## # … with 8 more variables: bytes &lt;int&gt;, format &lt;chr&gt;, iteration &lt;chr&gt;,
## #   parent &lt;lgl&gt;, children &lt;list&gt;, seconds &lt;dbl&gt;, warnings &lt;chr&gt;, error &lt;lgl&gt;
## 
## [[4]]
## # A tibble: 4 x 17
##   name  type  data  command depend    seed path  time                size  bytes
##   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;    &lt;int&gt; &lt;lis&gt; &lt;dttm&gt;              &lt;chr&gt; &lt;int&gt;
## 1 ref_… func… 39f7… &lt;NA&gt;    &lt;NA&gt;   NA      &lt;chr… NA                  &lt;NA&gt;     NA
## 2 filt… func… 6419… &lt;NA&gt;    &lt;NA&gt;   NA      &lt;chr… NA                  &lt;NA&gt;     NA
## 3 ref2  stem  cb38… 22b9ae… 43d0f… -2.20e8 &lt;chr… 2021-05-13 16:17:08 d8c8…   646
## 4 filt… stem  cb38… 55c19c… 77341…  9.90e7 &lt;chr… 2021-05-13 16:17:08 d8c8…   646
## # … with 7 more variables: format &lt;chr&gt;, iteration &lt;chr&gt;, parent &lt;lgl&gt;,
## #   children &lt;list&gt;, seconds &lt;dbl&gt;, warnings &lt;chr&gt;, error &lt;lgl&gt;</code></pre>
<p>I prefer the <code>*_read</code> approach because it’s explicit, but if you prefer to use the common R idiom of loading data using function side effects, you can also use <code>unitar_load</code>, which mimics the <code>tar_load</code> functionality:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/unitar_load.html">unitar_load</a></span><span class="op">(</span><span class="st">"big_data_set"</span>, <span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">big_data_set</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.39609368 -0.04912618 -1.39020596 -0.74866919  0.93453822  0.97008189</code></pre>
</div>
<div id="use-case-2-load-and-track-external-targets-locally" class="section level3">
<h3 class="hasAnchor">
<a href="#use-case-2-load-and-track-external-targets-locally" class="anchor"></a>Use case #2: Load and track external targets locally</h3>
<p>If there’s a target in an external project that you want to use in your current project, the basic way (above) just loaded the target in from that other project. Another way to do it is to actually track that external target as a target in the local project. The difference is that with this way, you’ll duplicate the cache of the file into the local folder. This duplication could be either an advantage or a disadvantage. If you want your project to be self-contained, with all your targets in the same folder, then you may want to track the files like that.</p>
<p>To do this, we will need to add new targets to the our local <code>_targets.R</code>, so it will track the external targets. To do this, use <code><a href="../reference/unitar_read_xprj.html">unitar_read_xprj()</a></code> like this:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># _targets.R</span>

<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/databio/unitar">"unitar"</a></span><span class="op">)</span>
<span class="va">tar_dirs</span><span class="op">=</span><span class="st">"../refdata1"</span>  <span class="co"># external targets projects you want to track</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/unitar_read_xprj.html">unitar_read_xprj</a></span><span class="op">(</span><span class="st">"big_data_set"</span>, <span class="va">tar_dirs</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## ../refdata1</code></pre>
<pre><code>## [[1]]
## [[1]][[1]]
## &lt;stem target&gt; 
##   name: file 
##   command:
##     NULL 
##   format: file 
##   iteration method: vector 
##   error mode: stop 
##   memory mode: persistent 
##   storage mode: main 
##   retrieval mode: main 
##   deploy to: worker 
##   resources:
##     list() 
##   cue:
##     mode: thorough
##     command: TRUE
##     depend: TRUE
##     format: TRUE
##     iteration: TRUE
##     file: TRUE 
##   packages:
##     unitar
##     withr
##     fs
##     targets
##     stats
##     graphics
##     grDevices
##     utils
##     datasets
##     methods
##     base 
##   library:
##     NULL
## [[1]][[2]]
## &lt;stem target&gt; 
##   name: big_data_set 
##   command:
##     unitar_read_from_path(file) 
##   format: rds 
##   iteration method: vector 
##   error mode: stop 
##   memory mode: persistent 
##   storage mode: main 
##   retrieval mode: main 
##   deploy to: worker 
##   resources:
##     list() 
##   cue:
##     mode: thorough
##     command: TRUE
##     depend: TRUE
##     format: TRUE
##     iteration: TRUE
##     file: TRUE 
##   packages:
##     unitar
##     withr
##     fs
##     targets
##     stats
##     graphics
##     grDevices
##     utils
##     datasets
##     methods
##     base 
##   library:
##     NULL</code></pre>
<p>So, it’s pretty simple, really. You can think of this as just registering any external targets into your local targets list. The <code>unitar_read_xprj</code> is a target factory that makes this super easy.</p>
</div>
<div id="use-case-3-tracking-external-targets-but-not-duplicating" class="section level3">
<h3 class="hasAnchor">
<a href="#use-case-3-tracking-external-targets-but-not-duplicating" class="anchor"></a>Use case #3: Tracking external targets but not duplicating</h3>
<p>Finally, there’s a third approach. What if you want to track the other external targets, so your stuff updates when they change, but you don’t want to duplicate large caches into your local folder? This leads to option 3. Here, what you want to do is add the external file to your target list so it gets tracked, and use that as input, and then use <code>unitar_read_from_path</code> in a local function to process that data into the subset you want to keep locally.</p>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># _targets.R</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://docs.ropensci.org/targets/">"targets"</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/databio/unitar">"unitar"</a></span><span class="op">)</span>

<span class="co"># Function that takes an external dataset (from another targets project),</span>
<span class="co"># and returns a modified version for this project.</span>
<span class="va">local_filter_big_reference_data</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">big_data_set_path</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">big_data_set</span> <span class="op">=</span> <span class="fu"><a href="../reference/unitar_read_from_path.html">unitar_read_from_path</a></span><span class="op">(</span><span class="va">big_data_set_path</span><span class="op">)</span>
  <span class="va">big_data_set</span><span class="op">[</span><span class="va">big_data_set</span> <span class="op">&gt;</span> <span class="fl">2</span><span class="op">]</span>
<span class="op">}</span>

<span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>
  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>
    <span class="va">big_data_set_path</span>,
    <span class="fu"><a href="../reference/unitar_path.html">unitar_path</a></span><span class="op">(</span><span class="st">"big_data_set"</span>, <span class="st">"../refdata1"</span><span class="op">)</span>,
    format <span class="op">=</span> <span class="st">"file"</span>
  <span class="op">)</span>,
  <span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_target.html">tar_target</a></span><span class="op">(</span>
    <span class="va">filtered_data_set</span>,
    <span class="fu">local_filter_big_reference_data</span><span class="op">(</span><span class="va">big_data_set_path</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">)</span></code></pre></div>
<pre><code>## [[1]]
## &lt;stem target&gt; 
##   name: big_data_set_path 
##   command:
##     unitar_path("big_data_set", "../refdata1") 
##   format: file 
##   iteration method: vector 
##   error mode: stop 
##   memory mode: persistent 
##   storage mode: main 
##   retrieval mode: main 
##   deploy to: worker 
##   resources:
##     list() 
##   cue:
##     mode: thorough
##     command: TRUE
##     depend: TRUE
##     format: TRUE
##     iteration: TRUE
##     file: TRUE 
##   packages:
##     unitar
##     withr
##     fs
##     targets
##     stats
##     graphics
##     grDevices
##     utils
##     datasets
##     methods
##     base 
##   library:
##     NULL
## [[2]]
## &lt;stem target&gt; 
##   name: filtered_data_set 
##   command:
##     local_filter_big_reference_data(big_data_set_path) 
##   format: rds 
##   iteration method: vector 
##   error mode: stop 
##   memory mode: persistent 
##   storage mode: main 
##   retrieval mode: main 
##   deploy to: worker 
##   resources:
##     list() 
##   cue:
##     mode: thorough
##     command: TRUE
##     depend: TRUE
##     format: TRUE
##     iteration: TRUE
##     file: TRUE 
##   packages:
##     unitar
##     withr
##     fs
##     targets
##     stats
##     graphics
##     grDevices
##     utils
##     datasets
##     methods
##     base 
##   library:
##     NULL</code></pre>
<p>Now, if <code>big_data_set</code> (from an external project) changes, that will invalidate your <code>filtered_data_set</code>, which will be recomputed. But you don’t actually duplicate <code>big_data_set</code> into your local targets cache, saving space.</p>
</div>
</div>
<div id="avoiding-passing-the-tar_dirs" class="section level2">
<h2 class="hasAnchor">
<a href="#avoiding-passing-the-tar_dirs" class="anchor"></a>Avoiding passing the tar_dirs</h2>
<p>Regardless of which of these options we choose, we’re going to end up making calls in our scripts like thiS:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">big_data_set</span> <span class="op">=</span> <span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/unitar_read.html">unitar_read</a></span><span class="op">(</span><span class="st">"big_data_set"</span>, <span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<p>But it’s more work to set up and pass around a <code>projects_folders</code> variable like this, relative to the simpler <code>targest::tar_read("big_data_set")</code> you could do in a local targets project. To get around this, all relevant <code>unitar</code> functions provide the ability to use R <code>options</code> as global variables, so you can set them once and then not worry about passing the project folders with every call. It’s pretty easy to set up:</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>tar_dirs<span class="op">=</span><span class="va">project_folders</span><span class="op">)</span></code></pre></div>
<p>Then you just leave that argument off of the <code>unitar_*</code> calls:</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">big_data_set</span> <span class="op">=</span> <span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/unitar_read.html">unitar_read</a></span><span class="op">(</span><span class="st">"big_data_set"</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossfactory</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/crossproj</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2</code></pre>
<p>Now, it’s just as easy as using <code>targets</code> natively, but you get the added power of grabbing targets from multiple projects.</p>
</div>
<div id="configuring-external-target-folders-with-pepr" class="section level2">
<h2 class="hasAnchor">
<a href="#configuring-external-target-folders-with-pepr" class="anchor"></a>Configuring external target folders with pepr</h2>
<p>The one possible place where this may not be ideal is if you want to maintain separate lists of folders, and query them separately. Using the <code><a href="https://rdrr.io/r/base/options.html">options(tar_dirs=project_folders)</a></code> approach limits you to a single <code>project_folders</code> variable. Alternatively, you can provide a list of folders in a configuration file for your project. <code>unitar</code> uses a project configuration file in <a href="http://pep.databio.org">standard PEP format</a>. You specify a list of target folders using the <code>tprojects</code> attribute, which may specify paths either absolute or relative to the configuration file.</p>
<p>For example, the <code>project_config.yaml</code> file for the above <code>project_folders</code> example might look like this:</p>
<pre><code>pep_version: "2.0.0"

tprojects:
  - ../target_projects/refdata1/
  - ../target_projects/refdata2/
  - ../</code></pre>
<p>To make this work, <code>unitar</code> provides a series of <code>peptar_*</code> functions that work like the <code>unitar_*</code> functions above, but operate on PEPs that you can configure with your list of project folders.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">pep_config</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"metadata/project_config.yaml"</span>, package<span class="op">=</span><span class="st">"unitar"</span><span class="op">)</span>
<span class="va">p</span> <span class="op">=</span> <span class="fu">pepr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pepr/man/Project.html">Project</a></span><span class="op">(</span><span class="va">pep_config</span><span class="op">)</span></code></pre></div>
<pre><code>## Loading config file: /Users/runner/work/_temp/Library/unitar/extdata/metadata/project_config.yaml</code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/peptar_dirs.html">peptar_dirs</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "/Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1/"
## [2] "/Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2/"
## [3] "/Users/runner/work/_temp/Library/unitar/extdata/"</code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/peptar_path.html">peptar_path</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"ref2"</span><span class="op">)</span></code></pre></div>
<pre><code>## ref2</code></pre>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/peptar_meta.html">peptar_meta</a></span><span class="op">(</span><span class="va">p</span>, fields<span class="op">=</span><span class="st">"name"</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1/</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2/</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/</code></pre>
<pre><code>## [[1]]
## # A tibble: 4 x 1
##   name                     
##   &lt;chr&gt;                    
## 1 build_big_reference_data 
## 2 filter_big_reference_data
## 3 big_data_set             
## 4 filtered_data            
## 
## [[2]]
## # A tibble: 4 x 1
##   name      
##   &lt;chr&gt;     
## 1 ref_data_2
## 2 filter_2  
## 3 ref2      
## 4 filt_ref2 
## 
## [[3]]
## # A tibble: 30 x 1
##    name          
##    &lt;chr&gt;         
##  1 unitar_exec   
##  2 peptar_folders
##  3 my_meta       
##  4 peptar_exec   
##  5 unitar_make   
##  6 unitar_meta   
##  7 peptar_make   
##  8 unitar_load   
##  9 unitar_path   
## 10 peptar_meta   
## # … with 20 more rows</code></pre>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">unitar</span><span class="fu">::</span><span class="fu"><a href="../reference/peptar_make.html">peptar_make</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre></div>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata1/</code></pre>
<pre><code>## ✔ skip target big_data_set
## ✔ skip target filtered_data
## ✔ skip pipeline</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/target_projects/refdata2/</code></pre>
<pre><code>## ✔ skip target ref2
## ✔ skip target filt_ref2
## ✔ skip pipeline</code></pre>
<pre><code>## /Users/runner/work/_temp/Library/unitar/extdata/</code></pre>
<pre><code>## Error in library("simpleCache") : 
##   there is no package called ‘simpleCache’</code></pre>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## [1] NA</code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">big_data_set2</span> <span class="op">=</span> <span class="fu"><a href="../reference/peptar_read.html">peptar_read</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"big_data_set"</span><span class="op">)</span></code></pre></div>
<pre><code>## big_data_set</code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_pattern.html">head</a></span><span class="op">(</span><span class="va">big_data_set2</span><span class="op">)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>Or, using <code>peptar_load</code>:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/peptar_load.html">peptar_load</a></span><span class="op">(</span><span class="va">p</span>, <span class="st">"big_data_set"</span><span class="op">)</span></code></pre></div>
<pre><code>## big_data_set</code></pre>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.ropensci.org/targets/reference/tar_pattern.html">head</a></span><span class="op">(</span><span class="va">big_data_set</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] -1.39609368 -0.04912618 -1.39020596 -0.74866919  0.93453822  0.97008189</code></pre>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nathan Sheffield.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
